Brian Cline	<brian@ircplanet.net>	2008-11-20

	* db_schema.sql: Added help for new NS info command.

	* Nickname/commands/info.php: Added new info command to NS to display
	detailed information about a user account.

	* Nickname/commands/register.php: Just in case -- set the deprecated 
	register_ts.

	* Nickname/commands.php: Add command entry for the new info command.

	* Core/db_user.php: Return the new timestamp for register time /
	create date. Also add a set_register_ts just in case.

Brian Cline	<brian@ircplanet.net>	2008-11-19

	* Core/core_globals.php: Bumped version 1.1.2 => 1.1.3.

	* Operator/globals.php: Bumped version 1.1.1 => 1.1.2.

	* Operator/os.php: Remove extraneous debugging output.

Brian Cline	<brian@ircplanet.net>	2008-11-19

	* Core/service.php: Add child-level event hooks for adding and
	removing glines. If implemented in a child class, these will be called
	automagically from the parent.

	* Core/p10/handle_B.php: Remove an extraneous print_array.

	* Operator/os.php: Implemented database storage of g-lines so that
	they can be persisted across sessions. Upon startup, the service will
	burst all glines to its uplink to ensure they are all being enforced.

	* Operator/db_gline.php: Implementation of the database-level Gline
	class.

	* db_schema.sql: Added the os_glines table to store gline information.

Brian Cline	<brian@ircplanet.net>	2008-11-19

	* (all): Converted source files from DOS to UNIX linebreak formats.

Brian Cline	<brian@ircplanet.net>	2008-11-19

	* (all): Removed executable flag from non-executable files.

Brian Cline	<brian@ircplanet.net>	2008-11-19

	* Operator/commands/topic.php: Somehow this never made it into the
	trunk. Oops.

	* Operator/globals.php: Bumped version 1.1.0 => 1.1.1.

Brian Cline	<brian@ircplanet.net>	2008-11-19

	* Nickname/globals.php: Bumped version 1.3.7 => 1.3.8.

	* Channel/globals.php: Bumped version 1.5.1 => 1.5.2.

	* Channel/commands/rdeftopic.php: Fixed broken command. Topic never
	got changed in the actual channel.

	* Channel/commands/register.php: Fixed the root of the missing
	creation TS bug, causing CS to burst channels with a zero timestamp
	upon startup. This will obviously cause problems with ircu when
	sending mode hacks and other change messages. Fortunately, not any
	more.

	* Channel/cs.php: Another part of the zero-TS bug mentioned above. If
	we don't have a create TS on record, use the register TS.

	* Channel/db_channel.php: Added set_register_date member function.

	* Core/core_globals.php: Bump version 1.1.1 => 1.1.2. Also added
	CORE_VENDOR constant to be included with the core services version (as
	seen in CTCP version replies).

	* Core/dbutils.php: Moved db_date to where it really belongs and made
	it act more like PHP's date(), where the timestamp argument is
	optional.

	* Core/stringutils.php: Moved db_date to where it really belongs.

Brian Cline	<brian@ircplanet.net>	2008-11-19

	* Core/service.php: Hide timer debug messages and fix old DB_User
	constructor behavior.

	* Core/db_user.php: We no longer need to attempt to set initial data
	on a new DB_User.

	* Core/db_record.php: Remove an unnecessary debug message.

	* Nickname/commands/register.php: Fixed a few typos causing a hard
	crash.

Brian Cline	<brian@ircplanet.net>	2008-11-19

	* Channel/cs: Fix stderr/stdout redirection in some versions of sh.
	
	* Nickname/ns: Fix stderr/stdout redirection in some versions of sh.
	
	* Operator/os: Fix stderr/stdout redirection in some versions of sh.
	
	* Stat/ss: Fix stderr/stdout redirection in some versions of sh.
	
Brian Cline	<brian@ircplanet.net>	2008-11-19

	* Core/timers/refresh_data.php: Attempting to resolve a critical bug
	where a user's account is not recognized by other services the first
	time it is created. This is because the AC message usually comes
	through from the other service before we've loaded the DB record. When
	this occurs, we weren't checking for any users whose account name was
	set but whose account ID was not set. This should hopefully fix the
	problem.

Brian Cline	<brian@ircplanet.net>	2008-11-19

	* db_schema.sql: Forgot to include the help text for all services.

Brian Cline	<brian@ircplanet.net>	2008-11-18
	
	* Channel/globals.php: Bumped version 1.5.0 => 1.5.1.

	* Core/globals.php: Bumped version 1.1.0 => 1.1.1.

	* Nickname/globals.php: Bumped version 1.3.6 => 1.3.7.

	* Channel/cs.ini: Match db_name against database name in
	db_schema.sql.

	* Nickname/ns.ini: Match db_name against database name in
	db_schema.sql.

	* Operator/os.ini: Match db_name against database name in
	db_schema.sql.

	* Stat/ss.ini: Match db_name against database name in
	db_schema.sql.

	* db_schema.sql: Added script to use for mysql imports. Not sure why
	this wasn't included in the first release, but here it is
	nonetheless...

	* Nickname/commands/register.php: Adjustment and bug fix involving
	class member visibility.

	* Channel/commands/access.php: Adjustments for class member
	visibility.

	* Channel/commands/moduser.php: Reduced unnecessary DB traffic when
	saving channel access information.

	* Channel/commands/adduser.php: Adjustments and bug fix involving
	class member visibility.

	* Channel/timer/expire_channels.php: Removed old code that had already
	been commented out long ago.

	* Channel/db_channel.php: Minor bug fix causing STDOUT output and the
	forgotten addition of get_url and set_url.

	* Channel/cs.php: Added a check to make sure a channel could be loaded
	when we are looking for loading channel access records. Removed unused
	code and also made minor adjustments involving class member
	visibility.

	* Core/service.php: Fixed a bug whereby timers would be skipped and
	never heard from again. This would definitely have been observed on
	any server that has its time adjusted periodically, as is typical with
	a crontab running ntpdate. Also added some debug messages to verify
	timers are not being lost.

	* Core/timers/refresh_data.php: Fixed a major bug whereby new accounts
	were not being loaded. Oops.

	* Core/db_user.php: Added a set_name member function.

	* Operator/tor-hosts: Updated the list.

	* Operator/download_tor_hosts: Added this shell script so folks could
	run it in a crontab to have their tor hosts file automagically
	updated for the tor host g-lining feature. A restart is NOT necessary
	after updating the tor hosts file.

Brian Cline	<brian@ircplanet.net>	2007-11-24

	* Nickname/globals.php: Bumped version 1.3.5 => 1.3.6.

	* Channel/globals.php: Bumped version 1.4.6 => 1.5.0.

	* Core/globals.php: Bumped version 1.0.10 => 1.1.0.

	* Operator/globals.php: Bumped version 1.0.1 => 1.1.0.

	* Nickname/commands/set.php: Added ability for service admins to
	modify other users' accounts with the SET command. Cleaned up debugs.

	* Channel/p10/handle_I.php: Added the ability for service admins to
	invite the channel service back into a channel when, for whatever
	reason, it is no longer in there.

	* Channel/commands/dumpall.php: Don't output everything in memory as
	it gets large rather quickly. Just do accounts since that's all we
	really use this for.

	* Channel/commands/ban.php: Remove old debug messages and make ban
	initialization easier to read.

	* Channel/commands/dumpuser.php: Prevent PHP error/warning messages
	from being generated when an array index (account name) doesn't exist.

	* Channel/commands/topic.php: Remove old debug messages.

	* Channel/commands/kick.php: Prevent users from using the channel
	service to kick other services from a channel.

	* Channel/commands/chaninfo.php: Added the CHANINFO command to provide
	basic information about a channel.

	* Channel/commands/set.php: Add the NOPURGE option for service admins
	to mark a channel as never expiring.

	* Channel/commands/acctreload.php: Add the ACCTRELOAD command for
	developer-level debugging. This forces the service to reload an
	account from the database.

	* Channel/commands/register.php: Fix assanine typo that was probably
	used for testing. This caused users to be able to register up to MAX+8
	channels.

	* Channel/timers/save_data.php: This is no longer necessary since we
	now save all data whenever it is updated.

	* Channel/timers/expire_channels.php: Fix loop to use OO-friendly
	accessor.

	* Channel/db_channel.php: Modified to inherit new DB_Record class,
	which provides DB-level operations and a slick way of developing
	record-based classes. This makes life much easier. Also make all known
	members protected so that they cannot be directly accessed. The record
	constructor is also more flexible now and can accept just a name, or a
	name and owner account ID.

	* Channel/db_channel_access.php: Modified to inherit new DB_Record
	class. Also made things more OO-compliant.

	* Channel/commands.php: Fix some minor spacing issues, and add the
	CHANINFO command.

	* Channel/db_ban.php: Modified to inherit new DB_Record class. Also
	made things more OO-compliant.

	* Channel/cs.php: Minor reworks to constructors and debug messages.
	Removed the refresh_data timer since it is now part of the core.
	Removed old commented lines and debug messages and fixed some mode
	reconciliation issues. Also made minor OO-related changes in line with
	the changes to each class.

	* Core/core_globals.php: Added the debugf function, which acts exactly
	like printf.

	* Core/service.php: Added a core-level timer to refresh any changed DB
	data. We only refresh data that has changed since the last refresh, to
	save on nasty overhead. Also removed old debug messages.

	* Core/ban.php: Removed old debug messages.

	* Core/dbutils.php: Removed old debug messages. Added a new db_queryf
	function that accepts a query in sprintf format. Also added an
	affected-row count to the query logger.

	* Core/channeluser.php: Initialize modes to 0. Don't know if this
	fixed any bugs or not, but it should have been this way a long time
	ago.

	* Core/channel.php: Added a function to clear all bans.

	* Core/p10/handle_B.php: Fixed some bugs in the channel burst
	reconciliation process, and removed some needless stuff.

	* Core/p10/handle_I.php: Add some basic variables so services can use
	them by name rather than argument number.

	* Core/p10/handle_J.php: Add a basic convenience variable for services
	to use.

	* Core/p10/handle_N.php: Add convenience variable to show whether the
	nick NICK line is a new or existing user.

	* Core/p10/handle_S.php: Remove old debug message and add a
	convenience variable for the new server object.

	* Core/p10/handle_SERVER.php: Add convenience variable for the new
	server object.

	* Core/timers/refresh_data.php: Heavily modified to reload only
	recently modified data -- that is, any data that has changed since our
	last refresh check.

	* Core/timer.php: Modified to always provide and store timer data as
	an array.

	* Core/db_user.php: Modified to inherit new DB_Record class. Also made
	things more OO-compliant.

	* Core/db_record.php: Added to provide an abstraction layer between
	record-centric classes and across-the-board record operations
	(create/update/read/delete). This is truly a life saver.

	* Core/bot.php: Removed old debug messages.

	* Core/stringutils.php: Removed old debug messages. Added support for
	year durations. Also added a db_date function that works like date
	except returns the format we need for our DATETIME database fields.

	* Operator/os.ini: Added preferences for the new Tor glining feature.
	Admins can now specify a text file that contains one IP address or
	hostname per line that represents a Tor node. The operator service
	will read in this list and automatically gline any users connecting
	from any IP/host in the list. This is mean, sure, but Tor is often
	used by malicious users in order to quickly and very easily circumvent
	glines, channel bans, cloning restrictions, etc.

	* Operator/p10/handle_T.php: Removed old debug messages.

	* Operator/commands/set.php: Removed old debug messages.

	* Operator/tor-hosts: Added an example of a Tor host list file, to be
	used with the new Tor glining capabilities in the operator service.

	* Operator/os.php: Added code to verify and load all Tor preferences.

	* Operator/globals.php: Added global variable for the Tor hosts file
	name.

	* Stat/p10/handle_A.php: Added AWAY handler.

	* Stat/p10/handle_B.php: Added burst handler.

	* Stat/p10/handle_C.php: Added channel create handler.

	* Stat/p10/handle_AC.php: Added user account update handler.

	* Stat/p10/handle_SQ.php: Added SQUIT handler.

	* Stat/p10/handle_D.php: Added kill handler.

	* Stat/p10/handle_J.php: Added join handler.

	* Stat/p10/handle_K.php: Added kick handler.

	* Stat/p10/handle_L.php: Added part handler.

	* Stat/p10/handle_M.php: Added mode handler.

	* Stat/p10/handle_N.php: Added nick handler.

	* Stat/p10/handle_P.php: Added private message handler.

	* Stat/p10/handle_Q.php: Added quit handler.

	* Stat/p10/handle_S.php: Added server handler.

	* Stat/p10/handle_T.php: Added topic handler.

	* Stat/p10/handle_V.php: Added remote version handler.

	* Stat/p10/handle_SERVER.php: Added uplink server handler.

	* Stat/commands/quote.php: Added quote command to pass raw privmsg
	data on as actual IRCu P10-n2k protocol.

	* Stat/commands/moduser.php: Added moduser command.

	* Stat/commands/inviteme.php: Added inviteme command.

	* Stat/commands/die.php: Added die command.

	* Stat/commands/remuser.php: Added remuser command.

	* Stat/commands/showcommands.php: Added showcommands command.

	* Stat/commands/uptime.php: Added uptime command.

	* Stat/commands/adduser.php: Added adduser command.

	* Stat/commands/help.php: Added help command.

	* Stat/ss.ini: Added configuration file.

	* Stat/timers/log_history.php: Added timer to automatically log basic
	counters describing the network size every minute.

	* Stat/commands.php: Added commands list.

	* Stat/globals.php: Added service global list.

	* Stat/ss.php: Added statistics service definition. This service will
	constantly monitor what is happening on the network and update a
	database copy of the user list, channel list, server list, and summary
	data. This is meant to be used in web-based service management
	environments (another upcoming project). This service is nowhere near
	finished, but the basics work well.

Brian Cline	<brian@ircplanet.net>	2007-01-07
	
	* Core/core_globals.php: Increment revision count.
	
	* Operator/globals.php: Increment revision count.

Brian Cline	<brian@ircplanet.net>	2007-01-07

	* Core/p10.php: Add numeric replies for client-side /whois responses. Also
	cleaned up several minor spacing issues.
	
	* Core/channel.php: Add an is_secret member to return whether or not the
	channel is +s.
	
	* Core/p10/handle_W.php: Added remote /whois replies to the core. These
	mostly follow the same rules as ircu-based /whoises with regard to
	user host-hiding and channel lists for services and regular users.
	Since I do not like ircu's "head-in-sand" defines, you will have to hack
	up handle_W.php if you need to hide additional information through this
	remote whois reply. However, keep in mind that if you have remote /whoises
	disabled on all your ircu servers, users will not be able to send whois 
	requests to this service and making changes to this file in order to hide
	whois info from them will not be necessary.
	
	* Core/user.php: Add last_spoke variable and corresponding get_idle_time 
	function to keep track of the last time a user has spoken. It is only
	updated inside of the Bot child class, so this is only used for remote
	whois replies about bots running on this server. Also added is_service
	function to return whether this user has +k, is_deaf() to return whether
	this user has +d, and is_local() to return if this user is on this server.
	And finally, fixed a bug that allowed a channel to be added to this user's
	channel list more than once.
	
	* Core/bot.php: Updated message() and messagef() functions to update the
	bot's last_spoke timestamp. Currently only used for whois replies about
	the bot.
	
	* Operator/p10/handle_A.php: Disable needless reporting of user away 
	status.
	
	* Operator/p10/handle_M.php: Disable reporting of channel mode changes.
	This can obviously cause a substantial amount of unnecessary log channel
	traffic on even smaller sized networks.

Brian Cline	<brian@ircplanet.net>	2006-12-20

	* Channel/globals.php: Incremented revision.

Brian Cline	<brian@ircplanet.net>	2006-12-20

	* Channel/db_channel.php: Delete channel bans whenever a channel is
	deleted. This fixes a startup bug where CS would die with a message related
	to "call to method add_ban on a non-object" when loading channel bans from
	the database for channels that had been delchan'ed or expired in the past.

	* Channel/cs.php: Added error checking for the above bug. A message will be
	logged if we come across any channel ban for a channel that does not exist.

Brian Cline	<brian@ircplanet.net>	2006-12-18

	* Channel/commands/register.php: Use new cs.ini constant for the maximum
	number of channels a user can register.

	* Channel/timers/expire_channels.php: Added timer code to automatically
	unregister channels where all owners have been absent for X days
	(configurable in cs.ini). By default, the timer runs every 5 minutes.

	* Channel/config.inc.php: Remove old constant for maximum registration
	count since it has moved to cs.ini.
	
	* Channel/cs.ini: Added value for maximum number of days a channel can be
	inactive (owner inactivity) before it is purged. Also added value for the
	maximum number of channels users are allowed to register.

	* Channel/globals.php: Incremented revision.

	* Channel/cs.php: Added new channel inactivity timer to timer stack.
	Removed old debug messages that are no longer necessary.

	* Core/service.php: Removed old debug messages that are no longer
	necessary.

	* Core/p10/handle_J.php: Removed old debug messages that are no longer
	necessary.
	
Brian Cline	<brian@ircplanet.net>	2006-11-25

	* Nickname/commands/ghost.php: Added GHOST command so that users can
	forcibly kill a ghost using their nick.

	* Nickname/commands.php: Added GHOST command to command list.

	* Nickname/globals.php: Incremented revision.
	
Brian Cline	<brian@ircplanet.net>	2006-10-28

	* Nickname/p10/handle_N.php: Only enforce a nick if it's enforce setting is
	turned on.

Brian Cline	<brian@ircplanet.net>	2006-10-28

	* Core/service.php: Added a kill() function to the service class. This will
	perform a server-based kill.

	* Core/p10.php: Added protocol format line for kills.

	* Core/bot.php: Added a kill() function to the bot class. This will perform
	a user-based kill.

	* Channel/p10/handle_J.php: Remove old debug messages.

	* Nickname/p10/handle_N.php: Added a timer line to make sure we are
	enforcing nicks with kills.

	* Nickname/timers/enforce.php: Added nick enforcement code.

	* Nickname/globals.php: Added constant for the Nickserv timer directory.

Brian Cline	<brian@ircplanet.net>	2006-10-21

	* Channel/commands/help.php: Fix small bug where help text variables
	were not being substituted before the text was sent out.

	* Channel/cs.php: More accomodations for proper channel bursts. If we
	receive a channel create timestamp that is smaller than the one we have
	stored, update it accordingly.

	* Channel/globals.php: Update revision count.

Brian Cline	<brian@ircplanet.net>	2006-10-16

	* Operator/commands/*: Added moduser, remuser, and adduser command
	handlers.

	* Operator/os.php: Modified get_user_level() to accept an integer as well
	so we can search for access by an account ID.

	* Operator/commands.php: Added lines for adduser, moduser, and remuser.

Brian Cline	<brian@ircplanet.net>	2006-10-14

	* Core/core_globals.php: Increment revision count.

	* Core/p10.php: Add formatter for the SETTIME token.

	* Core/service.php: The 'r' mode wasn't covered in clear_modes(). Also
	fixed a bug that wasn't updating the internal copy of a channel topic
	whenever the service set it. Modified the kick() function to allow for
	either a single numeric of a user to kick, or an array with multiple users.

	* Core/channel.php: Added get_op_list(), get_voice_list(), and
	get_user_list() to return an array of numerics that are ops, voices, or all
	channel users, respectively.

	* Core/user.php: Added get_signon_ts() to return the user's signon
	timestamp, and get_channel_list() to return an array of channel names that
	the user is joined to.

	* Core/stringutils.php: Added a standard get_date() function to convert a
	timestamp to a readable date/time in various places.

	* Operator/commands.php: Rearranged command list by level. Also added
	command lines for whois, whoison, settime, and clearchan.

	* Operator/commands/whois.php: Added WHOIS command to return information
	about a signed-on user.

	* Operator/commands/settime.php: Added SETTIME command to allow operator
	services to send out a network-wide timestamp so that all servers have the
	correct time.

	* Operator/commands/clearchan.php: Added CLEARCHAN command to allow opers
	to clear a channel's modes, deop all its users, devoice all its users,
	clear all its bans, kick all its users, or gline all its users. In cases
	where an oper requests to kick or gline all channel users, the service will
	make sure not to kick/gline the oper requesting the clearchan if they are
	on the channel at the time. It also will not perform actions on any service
	bots.

	* Operator/commands/whoison.php: Added WHOISON command to allow opers to
	see who is on a channel at any given time. The list is sorted
	alphabetically and includes @ and + characters to indicate op/voice status
	for users on the channel.

Brian Cline <brian@ircplanet.net>	2006-10-13

	* Core/bot.php: Make various adjustments to ensure that we send the proper
	timestmap with a channel mode change, thus avoiding any messy HACK(2)'s.
	
	* Operator/commands/*: Added chanlist and scan commands.
	
	* Operator/commands.php: Added chanlist and scan commands.

	* Operator/commands/clearmodes.php: Mode change should go through as
	server, not bot.

Brian Cline	<brian@ircplanet.net>	2006-10-09

	* Initial subversion import.

